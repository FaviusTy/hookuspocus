"use strict";const contextMap=new(WeakMap||Map);let currentContext;const createHookApi=(e,t)=>{const o=t.hookStates[t.hookStateIndex];return{onCleanUp(e){o.cleanUp=e},beforeNextRun(e){o.beforeNextRun=e},afterCurrentRun(e){o.afterCurrentRun=e},getContext:()=>currentContext,getValue:e=>(void 0===o.value&&(o.value=e),o.value),setValue(n,r=!1){let a=o.value;o.value=n,!r&&t.onValueChange&&t.onValueChange(e,n,a)}}};export const createHook=(e,t)=>(...o)=>{if(void 0===currentContext)throw new Error("Hook was called outside of run()!");const n=contextMap.get(currentContext);return n.hookStateIndex++,void 0===n.hookStates[n.hookStateIndex]&&(n.hookStates[n.hookStateIndex]={value:void 0},n.hookStates[n.hookStateIndex].hookApi=createHookApi(e,n)),t(n.hookStates[n.hookStateIndex].hookApi,...o)};function runLifeCycleCallback(e,t){for(const o of t)o[e]&&(o[e](),o[e]=void 0)}export const hookus=(e,t)=>{if(!(e instanceof Object))throw new Error("Context must be an object!");contextMap.set(e,{hookStates:[],hookStateIndex:-1,onValueChange:t})};export const cleanUp=e=>{runLifeCycleCallback("cleanUp",contextMap.get(e).hookStates)};export const dispose=e=>{const t=contextMap.get(e);runLifeCycleCallback("cleanUp",t.hookStates),t.hookStates.length=0,t.delete(e)};export const pocus=(e,t,...o)=>{if(void 0!==currentContext)throw new Error("Tried to start a run before the end of the previous run!");if(!contextMap.has(e))throw new Error("Tried to start a run without a registered context!");currentContext=e;const n=contextMap.get(currentContext);n.hookStateIndex=-1,runLifeCycleCallback("beforeNextRun",n.hookStates);const r=t(...o),a=e=>(runLifeCycleCallback("afterCurrentRun",n.hookStates),currentContext=void 0,e);return r instanceof Promise?r.then(a):a(r)};export const hookuspocus=(e,{context:t,onValueChange:o})=>{void 0===t&&(t=e),hookus(t,o);const n=function(...o){return pocus(t,e,...o)};return n.dispose=(()=>{dispose(t),t=void 0,e=void 0}),n.cleanUp=(()=>cleanUp(t)),n};export const useReducer=createHook("useReducer",({getValue:e,setValue:t},o,n)=>{const r=e(n);return[r,e=>{t(o(r,e))}]});export const useState=e=>{const[t,o]=useReducer((e,t)=>t.value,e);return[t,e=>o({type:"set_state",value:e})]};export const useEffect=createHook("useEffect",({getValue:e,setValue:t,onCleanUp:o,afterCurrentRun:n},r,a)=>{let{values:u,cleanUp:c}=e({}),s=!1;if(u!==a&&u&&u.length>0){s=!0;let e=u.length;for(;e--;)if(a[e]!==u[e]){s=!1;break}u=a}s||(c&&c(),n(()=>{"function"!=typeof(c=r())&&(c=void 0),t({values:a,cleanUp:c}),o(c?()=>{c()}:void 0)}))});
//# sourceMappingURL=index.min.js.map