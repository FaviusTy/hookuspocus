{"version":3,"file":"hookuspocus.mjs","sources":["../src/core.js","../src/use_effect.js","../src/use_reducer.js","../src/use_state.js","../src/wrap_function.js"],"sourcesContent":["let hookIndex;\nlet stackIndex;\nconst hookDataStack = [];\nconst dataMap = new (WeakMap || Map)();\nexport const on = (hook, cb) => {\n  dataMap.set(hook, cb);\n};\nexport const hookus = hookFunction => {\n  return function hook() {\n    const context = hookDataStack[stackIndex][0];\n    hookIndex++;\n    const data =\n      hookDataStack[stackIndex][hookIndex] ||\n      (hookDataStack[stackIndex][hookIndex] = [\n        { context, hook: hookFunction }\n      ]);\n    return (dataMap.get(hook) || hookFunction).apply(\n      {},\n      data.concat(Array.from(arguments))\n    );\n  };\n};\nconst runLifeCycles = name => {\n  hookDataStack[stackIndex].forEach(data => {\n    if (data[0] && data[0][name]) {\n      data[0][name]();\n      delete data[0][name];\n    }\n  });\n};\nexport const pocus = function() {\n  const args = Array.from(arguments);\n  let funcArgs;\n  if (args[0][\"pop\"]) {\n    funcArgs = args.shift();\n  }\n  const context = typeof args[1] === \"boolean\" ? args[0] : args[1] || args[0];\n  const cleanUp = args[1] === true || args[2];\n  hookIndex = 0;\n  stackIndex = hookDataStack.push(dataMap.get(context) || [context]) - 1;\n  dataMap.set(context, hookDataStack[stackIndex]);\n  let result;\n  if (cleanUp === true) {\n    runLifeCycles(\"cleanUp\");\n    dataMap.delete(context);\n  } else {\n    runLifeCycles(\"before\");\n    result = args[0].apply(args[0], funcArgs);\n    runLifeCycles(\"after\");\n  }\n  hookDataStack.pop();\n  return result;\n};\n","import { hookus } from \"./core\";\nexport const useEffect = hookus((data, effect, values) => {\n  if (\n    !data.v ||\n    (values &&\n      !(\n        values.length === data.v.length &&\n        values.every(value => ~data.v.indexOf(value))\n      ))\n  ) {\n    data.v = values;\n    if (data.cleanUp) {\n      data.cleanUp();\n    }\n    data.after = () => {\n      data.cleanUp = effect();\n    };\n  }\n});\n","import { hookus } from \"./core\";\n\nexport const useReducer = hookus((data, reducer, initialArg, init) => {\n  data.s = data.s !== undefined ? data.s : init ? init(initialArg) : initialArg;\n  return [\n    data.s,\n    action => {\n      data.s = reducer(data.s, action);\n      return data.s;\n    }\n  ];\n});\n","import { useReducer } from \"./use_reducer\";\n\nexport const useState = initialState => {\n  const [state, dispatch] = useReducer(\n    (_, action) => action.value,\n    initialState\n  );\n  return [\n    state,\n    newState =>\n      dispatch({\n        value: newState\n      })\n  ];\n};\n","import { pocus } from \"./core\";\n\nexport const fidibus = (func, context) => {\n  const out = function() {\n    const args = Array.from(arguments);\n    if (args.length > 0) {\n      return pocus(args, func, context);\n    } else {\n      return pocus(func, context);\n    }\n  };\n  out.cleanUp = () => {\n    pocus(func, context, true);\n  };\n  return out;\n};\n"],"names":["let","hookIndex","stackIndex","hookDataStack","dataMap","WeakMap","Map","on","hook","cb","set","hookus","hookFunction","data","get","apply","concat","Array","from","arguments","runLifeCycles","name","forEach","pocus","funcArgs","args","shift","result","context","cleanUp","push","delete","pop","useEffect","effect","values","v","length","every","value","indexOf","after","useReducer","reducer","initialArg","init","s","undefined","action","useState","initialState","_","newState","dispatch","fidibus","func","out"],"mappings":"AAAAA,IAAIC,EACAC,EACEC,EAAgB,GAChBC,EAAU,IAAKC,SAAWC,KACnBC,WAAMC,EAAMC,GACvBL,EAAQM,IAAIF,EAAMC,IAEPE,WAASC,UACb,SAASJ,QAGRK,EACJV,EAAcD,KAFhBD,KAGGE,EAAcD,GAAYD,GAAa,CACtC,SALYE,EAAcD,GAAY,GAK3BM,KAAMI,YAEbR,EAAQU,IAAIN,IAASI,GAAcG,MACzC,GACAF,EAAKG,OAAOC,MAAMC,KAAKC,eAIvBC,WAAgBC,GACpBlB,EAAcD,GAAYoB,iBAAQT,GAC5BA,EAAK,IAAMA,EAAK,GAAGQ,KACrBR,EAAK,GAAGQ,YACDR,EAAK,GAAGQ,OAIRE,EAAQ,eAEfC,EADEC,EAAOR,MAAMC,KAAKC,WAEpBM,EAAK,GAAL,MACFD,EAAWC,EAAKC,aAOdC,EALEC,EAA6B,kBAAZH,EAAK,GAAmBA,EAAK,GAAKA,EAAK,IAAMA,EAAK,GACnEI,GAAsB,IAAZJ,EAAK,IAAeA,EAAK,UACzCxB,EAAY,EACZC,EAAaC,EAAc2B,KAAK1B,EAAQU,IAAIc,IAAY,CAACA,IAAY,EACrExB,EAAQM,IAAIkB,EAASzB,EAAcD,KAEnB,IAAZ2B,GACFT,EAAc,WACdhB,EAAQ2B,OAAOH,KAEfR,EAAc,UACdO,EAASF,EAAK,GAAGV,MAAMU,EAAK,GAAID,GAChCJ,EAAc,UAEhBjB,EAAc6B,MACPL,GClDIM,EAAYtB,WAAQE,EAAMqB,EAAQC,GAE1CtB,EAAKuB,KACLD,GAEGA,EAAOE,SAAWxB,EAAKuB,EAAEC,QACzBF,EAAOG,eAAMC,UAAU1B,EAAKuB,EAAEI,QAAQD,QAG1C1B,EAAKuB,EAAID,EACLtB,EAAKgB,SACPhB,EAAKgB,UAEPhB,EAAK4B,iBACH5B,EAAKgB,QAAUK,QCbRQ,EAAa/B,WAAQE,EAAM8B,EAASC,EAAYC,UAC3DhC,EAAKiC,OAAeC,IAAXlC,EAAKiC,EAAkBjC,EAAKiC,EAAID,EAAOA,EAAKD,GAAcA,EAC5D,CACL/B,EAAKiC,WACLE,UACEnC,EAAKiC,EAAIH,EAAQ9B,EAAKiC,EAAGE,GAClBnC,EAAKiC,MCNLG,WAAWC,SACIR,WACvBS,EAAGH,UAAWA,EAAOT,OACtBW,gBAEK,eAELE,UACEC,EAAS,CACPd,MAAOa,OCTFE,WAAWC,EAAM3B,OACtB4B,EAAM,eACJ/B,EAAOR,MAAMC,KAAKC,kBACpBM,EAAKY,OAAS,EACTd,EAAME,EAAM8B,EAAM3B,GAElBL,EAAMgC,EAAM3B,WAGvB4B,EAAI3B,mBACFN,EAAMgC,EAAM3B,GAAS,IAEhB4B"}