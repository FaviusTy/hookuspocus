!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).funcyjs={})}(this,function(e){"use strict";const t=Symbol("outside_run");let n=t;const o=new(WeakMap||Map),a=()=>{n=t},r=(e,a)=>(...r)=>{if(n.context===t)throw new Error("Hook was called outside of run()!");n.hookStateIndex++;const s=(e=>{const t=o.get(n.context);void 0===t[n.hookStateIndex]&&(t[n.hookStateIndex]={});const a=t[n.hookStateIndex],r=n.onStateChange;return{onCleanUp(e){a.cleanUp=e},beforeNextRun(e){a.beforeNextRun=e},afterCurrentRun(e){a.afterCurrentRun=e},getContext:()=>n.context,getState:e=>(void 0===a.state&&(a.state=e),a.state),setState(t,n=!1){let o=a.state;a.state=t,!n&&r&&r(e,o,t)}}})(e);return a(...r,s)};function s(e,t,n){let o=n;for(;o--;){const a=t[n-o-1];a[e]&&(a[e](),a[e]=void 0)}}const c=r("useReducer",(e,t,{getState:n,setState:o})=>{const a=n(t);return[a,t=>{o(e(a,t))}]}),u=r("useState",e=>{const[t,n]=c((e,t)=>t.value,e);return[t,e=>n({type:"set_state",value:e})]}),f=r("useEffect",(e,...t)=>{let n;t.length>1&&(n=t[0]);const{getState:o,setState:a,onCleanUp:r,afterCurrentRun:s}=t[t.length-1];let{values:c,cleanUp:u}=o({}),f=!1;if(c!==n&&c&&c.length>0){f=!0;let e=c.length;for(;e--;)if(n[e]!==c[e]){f=!1;break}c=n}f||(u&&u(),s(()=>{u=e(),a({values:n,cleanUp:u}),r(u?()=>{u()}:void 0)}))});e.createHook=r,e.cleanUp=(e=>{const t=o.get(e);s("cleanUp",t,t.length)}),e.dispose=(e=>{const t=o.get(e);s("cleanUp",t,t.length),o.delete(e)}),e.run=((e,...t)=>{if("function"==typeof e&&(e={context:e,function:e}),!(e.context instanceof Object))throw new Error("Run was called without a valid object context!");(n=e).hookStateIndex=-1;let r=!1;o.has(n.context)||(o.set(n.context,[]),r=!0);const c=o.get(n.context),u=c.length;s("beforeNextRun",c,u);const f=e.function(...t);return f instanceof Promise?f.then(e=>(s("afterCurrentRun",c,r?c.length:u),a(),e)):(s("afterCurrentRun",c,r?c.length:u),a(),f)}),e.useReducer=c,e.useState=u,e.useEffect=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=hooked.min.js.map
